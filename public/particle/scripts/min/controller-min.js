"use strict";define(["emitter","vector","field","utils","audio"],function(e,t,i,n,s){var a={canvas:void 0,ctx:void 0,centerX:void 0,centerY:void 0,emitters:[],drawQueue:[],updateQueue:[],fields:[],maxFields:3,maxEmitters:2,audioData:void 0,initEmitters:function(){var i=new e(this,new t(this.centerX,this.centerY),t.fromAngle(0,2),Math.PI);this.addEmitter(i)},initFields:function(){var e=new i(this.ctx,new t(this.centerX+this.centerX/2,this.centerY),300);this.addField(e),e=new i(this.ctx,new t(this.centerX-this.centerX/2,this.centerY),300),this.addField(e)},initAudio:function(){var e=this;s.init(document.querySelector("audio")),this.updateQueue.push(s.update.bind(s)),this.audioData=s.getAudioData();var t=s.getNumber();setInterval(function(){t=s.getNumber();for(var i=0;i<e.fields.length;i++)e.fields[i].effectMass(t)},1e3)},initEvents:function(){var s=this,a=0;this.canvas.addEventListener("click",function(){s.fields.length>s.maxFields&&s.fields.shift(),a++;var e;e=a%2===0?-100:100;var u=n.getMouse(this),d=new i(s.ctx,new t(u.x,u.y),e);s.addField(d)}),this.canvas.addEventListener("contextmenu",function(i){i.preventDefault();var a=n.getMouse(this),i=new e(s,new t(a.x,a.y),t.fromAngle(Math.random(),Math.random()),n.getRandom(0,.5));return s.addEmitter(i),!1}),document.querySelector('select[name="max-emitters"]').onchange=function(){if(s.maxEmitters=this.value,s.emitters.length>s.maxEmitters)for(var e=0;e<s.emitters.length-s.maxEmitters;e++)s.updateQueue[s.emitters[e].updateIndex]=null,s.drawQueue[s.emitters[e].drawIndex]=null,s.emitters.shift()},document.querySelector('select[name="max-fields"]').onchange=function(){if(s.maxFields=this.value,s.fields.length>s.maxFields)for(var e=0;e<s.fields.length-s.maxFields;e++)s.drawQueue[s.fields[e].drawIndex]=null,s.fields.shift()},document.querySelector("#max-particles").onchange=function(){var e=this;if(e.value>=1e3&&e.value<2e3)var t=1;else if(e.value>=2e3&&e.value<3e3)var t=1;else if(e.value>=3e3&&e.value<4e3)var t=2;else if(e.value>=4e3&&e.value<=5e3)var t=3;s.emitters.forEach(function(i){i.changeParticleNum(e.value,t)})},document.querySelector("#clear-fields").onclick=function(e){e.preventDefault();for(var t=0;t<s.fields.length;t++)s.drawQueue[s.fields[t].drawIndex]=null;s.fields=[]},document.querySelector("#clear-emitters").onclick=function(e){e.preventDefault();for(var t=0;t<s.emitters.length;t++)s.updateQueue[s.emitters[t].updateIndex]=null,s.drawQueue[s.emitters[t].drawIndex]=null;s.emitters=[]},document.querySelector("#reset").onclick=function(e){e.preventDefault(),s.emitters=[],s.fields=[],s.drawQueue=[],s.updateQueue=[]}},addField:function(e){this.drawQueue.push(e.draw.bind(e)),e.drawIndex=this.drawQueue.length-1,this.fields.push(e),this.fields.length>this.maxFields&&(this.drawQueue[this.fields[0].drawIndex]=null,this.fields.shift())},getFields:function(){return this.fields},addEmitter:function(e){this.drawQueue.push(e.draw.bind(e)),this.updateQueue.push(e.update.bind(e)),e.drawIndex=this.drawQueue.length-1,e.updateIndex=this.updateQueue.length-1,this.emitters.push(e),this.emitters.length>this.maxEmitters&&(this.updateQueue[this.emitters[0].updateIndex]=null,this.drawQueue[this.emitters[0].drawIndex]=null,this.emitters.shift())},update:function(){this.updateQueue.forEach(function(e){e&&e()})},draw:function(){this.drawQueue.forEach(function(e){e&&e()})},animate:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.update(),this.draw(),window.requestAnimationFrame(this.animate.bind(this))},init:function(){this.canvas=document.querySelector("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.centerX=this.canvas.width/2,this.centerY=this.canvas.height/2,this.ctx=this.canvas.getContext("2d"),this.initAudio(),this.initEmitters(),this.initFields(),this.animate(),this.initEvents()}};return a});